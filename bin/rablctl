#!/bin/sh
# -*- tab-width:4;indent-tabs-mode:nil -*-
# ex: ts=4 sw=4 et

# Pull environment for this install
. "`cd \`dirname $0\` && /bin/pwd`/../lib/env.sh"

# Make sure the user running this script is the owner and/or su to that user
check_user "$@"
ES=$?
if [ "$ES" -ne 0 ]; then
    exit $ES
fi

# Keep track of where script was invoked
ORIGINAL_DIR=$(pwd)

# Make sure CWD is set to runner run dir
cd $RUNNER_BASE_DIR

# Identify the script name
SCRIPT=`basename $0`

usage() {
    echo "Usage: $SCRIPT { load | show-config | start |setup |  add-hook | stop | status | stats } "
}

# Check the first argument for instructions
case "$1" in
     load)
       if [ $# -ne 1 ]; then
            echo "Usage: $SCRIPT load"
            exit 1
        fi
        shift
         # Make sure the local node is running
        node_up_check

        NODETOOL rpc rabl_console load "$@"
        ;;
     show[-_]config)
      if [ $# -ne 1 ]; then
            echo "Usage: $SCRIPT show-config"
            exit 1
        fi
        shift
         # Make sure the local node is running
        node_up_check

        NODETOOL rpc rabl_console show_config "$@"
        ;;
     start)
       if [ $# -ne 1 ]; then
            echo "Usage: $SCRIPT start"
            exit 1
        fi
        shift
         # Make sure the local node is running
        node_up_check

        NODETOOL rpc rabl_console start "$@"
        ;;
     add[-_]hook)
      if [ $# -ne 2 ]; then
            echo "Usage: $SCRIPT add-hook <<BUCKET>>"
            exit 1
        fi
         # Make sure the local node is running
        node_up_check

        NODETOOL rpc rabl_console add_hook "$2"
        ;;
     setup)
       if [ $# -ne 1 ]; then
            echo "Usage: $SCRIPT setup"
            exit 1
        fi
        shift
         # Make sure the local node is running
        node_up_check

        NODETOOL rpc rabl_console setup "$@"
        ;;
    stop)
       if [ $# -ne 1 ]; then
            echo "Usage: $SCRIPT stop"
            exit 1
        fi
        shift
         # Make sure the local node is running
        node_up_check

        NODETOOL rpc rabl_console stop "$@"
        ;;
    status)
       if [ $# -ne 1 ]; then
            echo "Usage: $SCRIPT status"
            exit 1
        fi
        shift
         # Make sure the local node is running
        node_up_check

        NODETOOL rpc rabl_console status "$@"
        ;;
    stats)
       if [ $# -ne 1 ]; then
            echo "Usage: $SCRIPT stats"
            exit 1
        fi
        shift
         # Make sure the local node is running
        node_up_check

        NODETOOL rpc rabl_console stats "$@"
        ;;
      *)
        usage
        exit 1
        ;;
esac